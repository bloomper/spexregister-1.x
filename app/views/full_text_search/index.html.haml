= render :partial => 'sub_menu'

%div.left
  %h1= t 'views.full_text_search.index_title'

%div.right
  = link_to icon_tag('reset') + ' ' + t('views.full_text_search.reset_search_result'), full_text_search_url('dummy'), :method => :delete, :class => 'button small'
  = render :partial => '/shared/export_menu', :locals => { :reports => get_available_reports, :id => 'latest_full_text_search_query_ids' }

%br.clear

- if @search_result.total == 0
  %p= t 'views.full_text_search.empty_search_result'
- else
  .number-of-hits= page_entries_info @search_result.hits, { :entry_translation_group_key => 'spexare' }
  %table.index#search_result
    %tr
      %th.score-column= order_full_text params[:order], :by => :score, :as => t('views.full_text_search.score'), :params => {:controller => :full_text_search, :action => :index, :query => params[:query] }
      %th= order_full_text params[:order], :by => :last_name, :as => t('activerecord.attributes.spexare.last_name'), :params => {:controller => :full_text_search, :action => :index, :query => params[:query] }
      %th= order_full_text params[:order], :by => :first_name, :as => t('activerecord.attributes.spexare.first_name'), :params => {:controller => :full_text_search, :action => :index, :query => params[:query] }
      %th= order_full_text params[:order], :by => :nick_name, :as => t('activerecord.attributes.spexare.nick_name'), :params => {:controller => :full_text_search, :action => :index, :query => params[:query] }
      %th.action-column= t 'views.base.action'
      - @search_result.hits.each do |hit|
        %tr{:id => hit.primary_key, :class => cycle('even', 'odd')}
          %td= h hit.score.round(2)
          %td= h hit.stored(:last_name)
          %td= h hit.stored(:first_name)
          %td= h hit.stored(:nick_name)
          %td.actions
            = link_to_view_action_with_url spexare_url(hit.primary_key)
            = link_to_edit_action_with_url edit_spexare_url(hit.primary_key) if current_user_is_admin? || (!current_user.spexare.nil? && current_user.spexare.id == hit.primary_key)
            = link_to_delete_action_with_url hit.primary_key, spexare_url(hit.primary_key), { :table => 'search_result' } if current_user_is_admin?

= will_paginate(@search_result.hits, :previous_label => "&#171; #{t('views.base.previous')}", :next_label => "#{t('views.base.next')} &#187;")           

- if @search_result.total > 0
  %div.facets
    %h2= t 'views.full_text_search.facets_title'
    %small= t 'views.full_text_search.facet_notice'
  
    - if !@search_result.facet(:facet_spex_categories).nil?
      %div.facet
        %h2= t 'views.full_text_search.facet_spex_categories_title' 
        %ul
          - @search_result.facet(:facet_spex_categories).rows.each do |row|
            %li== #{link_to_unless((params[:facet_spex_categories] || []).include?(row.value), row.value, params.merge(:facet_spex_categories => ((params[:facet_spex_categories] || []) + [row.value])).except(:page))} (#{row.count})
    
    %br.clear
    
    - if !@search_result.facet(:facet_spex_years).nil?
      %div.facet
        %h2= t 'views.full_text_search.facet_spex_years_title' 
        %ul
          - @search_result.facet(:facet_spex_years).rows.each do |row|
            %li== #{link_to_unless((params[:facet_spex_years] || []).include?(row.value), row.value, params.merge(:facet_spex_years => ((params[:facet_spex_years] || []) + [row.value])).except(:page))} (#{row.count})
    
    %br.clear
    
    - if !@search_result.facet(:facet_spex_titles).nil?
      %div.facet
        %h2= t 'views.full_text_search.facet_spex_titles_title' 
        %ul
          - @search_result.facet(:facet_spex_titles).rows.each do |row|
            %li== #{link_to_unless((params[:facet_spex_titles] || []).include?(row.value), row.value, params.merge(:facet_spex_titles => ((params[:facet_spex_titles] || []) + [row.value])).except(:page))} (#{row.count})
    
    %br.clear
    
    - if !@search_result.facet(:facet_function_categories).nil?
      %div.facet
        %h2= t 'views.full_text_search.facet_function_categories_title' 
        %ul
          - @search_result.facet(:facet_function_categories).rows.each do |row|
            %li== #{link_to_unless((params[:facet_function_categories] || []).include?(row.value), row.value, params.merge(:facet_function_categories => ((params[:facet_function_categories] || []) + [row.value])).except(:page))} (#{row.count})
    
    %br.clear
    
    - if !@search_result.facet(:facet_function_names).nil?
      %div.facet
        %h2= t 'views.full_text_search.facet_function_names_title' 
        %ul
          - @search_result.facet(:facet_function_names).rows.each do |row|
            %li== #{link_to_unless((params[:facet_function_names] || []).include?(row.value), row.value, params.merge(:facet_function_names => ((params[:facet_function_names] || []) + [row.value])).except(:page))} (#{row.count})
